rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Allow public read access to all files in storage.
    // This is useful for images that are meant to be public, like background images.
    match /{allPaths=**} {
      allow read;
    }

    // Rules for user profile photos.
    // The path matches a file named after the user's ID inside the "profile_photos" folder.
    match /profile_photos/{userId} {
      // Allow a user to write (upload, update, delete) to their own profile photo path.
      // The request must be authenticated, and the user's ID must match the file name.
      // We also enforce a 5MB size limit and require the file to be an image.
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      request.resource.size < 5 * 1024 * 1024 &&
                      request.resource.contentType.matches('image/.*');
    }
  }
}
