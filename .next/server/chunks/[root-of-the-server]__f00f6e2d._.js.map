{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase-admin.ts"],"sourcesContent":["\nimport * as admin from 'firebase-admin';\n\n// This utility ensures that the Firebase Admin SDK is initialized only once\n// across all server-side requests in a serverless environment.\n\ninterface FirebaseAdmin {\n  auth: admin.auth.Auth;\n  firestore: admin.firestore.Firestore;\n  storage: admin.storage.Storage;\n}\n\nif (!admin.apps.length) {\n  try {\n    admin.initializeApp({\n      credential: admin.credential.applicationDefault(),\n      storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n    });\n    console.log('Firebase Admin SDK initialized successfully.');\n  } catch (error) {\n    console.error('Firebase Admin SDK initialization error:', error);\n  }\n}\n\nconst auth = admin.auth();\nconst firestore = admin.firestore();\nconst storage = admin.storage();\n\nexport function getFirebaseAdmin(): FirebaseAdmin {\n  return { auth, firestore, storage };\n}\n"],"names":[],"mappings":";;;AACA;;AAWA,IAAI,CAAC,2HAAA,CAAA,OAAU,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,CAAA,GAAA,2HAAA,CAAA,gBAAmB,AAAD,EAAE;YAClB,YAAY,2HAAA,CAAA,aAAgB,CAAC,kBAAkB;YAC/C,eAAe,QAAQ,GAAG,CAAC,mCAAmC;QAChE;QACA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4CAA4C;IAC5D;AACF;AAEA,MAAM,OAAO,CAAA,GAAA,2HAAA,CAAA,OAAU,AAAD;AACtB,MAAM,YAAY,CAAA,GAAA,2HAAA,CAAA,YAAe,AAAD;AAChC,MAAM,UAAU,CAAA,GAAA,2HAAA,CAAA,UAAa,AAAD;AAErB,SAAS;IACd,OAAO;QAAE;QAAM;QAAW;IAAQ;AACpC","debugId":null}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/create-subscription/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { getFirebaseAdmin } from '@/lib/firebase-admin';\nimport Razorpay from 'razorpay';\nimport { headers } from 'next/headers';\n\nexport async function POST(req: Request) {\n  const { planId } = await req.json();\n  const headersList = headers();\n  const authorization = headersList.get('authorization');\n\n  if (!authorization || !authorization.startsWith('Bearer ')) {\n    return NextResponse.json({ error: 'Unauthorized: Missing or invalid token' }, { status: 401 });\n  }\n\n  const token = authorization.split('Bearer ')[1];\n  const { auth, firestore } = getFirebaseAdmin();\n\n  let decodedToken;\n  try {\n    decodedToken = await auth.verifyIdToken(token);\n  } catch (error) {\n    console.error('API_ROUTE: Invalid auth token:', error);\n    return NextResponse.json({ error: 'Unauthorized: Invalid token' }, { status: 401 });\n  }\n\n  const userId = decodedToken.uid;\n  \n  try {\n    const userDocRef = firestore.collection('users').doc(userId);\n    const userDoc = await userDocRef.get();\n\n    if (!userDoc.exists) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n    const userProfile = userDoc.data();\n    if (!userProfile) {\n        return NextResponse.json({ error: 'User profile not found' }, { status: 404 });\n    }\n\n    const key_id = process.env.RAZORPAY_KEY_ID;\n    const key_secret = process.env.RAZORPAY_KEY_SECRET;\n\n    if (!key_id || !key_secret) {\n        console.error('FATAL: Razorpay API keys are not configured.');\n        return NextResponse.json({ error: 'Payment gateway not configured.' }, { status: 500 });\n    }\n\n    const instance = new Razorpay({ key_id, key_secret });\n\n    const subscriptionData = {\n      plan_id: planId,\n      total_count: 12, // For a yearly subscription with monthly payments\n      quantity: 1,\n      customer_notify: 1,\n      notes: {\n        firebase_uid: userId, // This is the critical link\n      },\n    };\n    \n    const subscription = await instance.subscriptions.create(subscriptionData);\n\n    // Save customer ID to user profile for future reference\n    if (subscription.customer_id) {\n       await userDocRef.set({ razorpayCustomerId: subscription.customer_id }, { merge: true });\n    }\n\n    return NextResponse.json({ subscriptionId: subscription.id, key_id: key_id });\n\n  } catch (error: any) {\n    console.error('Error creating Razorpay subscription:', error);\n    return NextResponse.json({ error: error.message || 'Failed to create subscription link.' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;AACA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;IACjC,MAAM,cAAc,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IAC1B,MAAM,gBAAgB,YAAY,GAAG,CAAC;IAEtC,IAAI,CAAC,iBAAiB,CAAC,cAAc,UAAU,CAAC,YAAY;QAC1D,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyC,GAAG;YAAE,QAAQ;QAAI;IAC9F;IAEA,MAAM,QAAQ,cAAc,KAAK,CAAC,UAAU,CAAC,EAAE;IAC/C,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,iIAAA,CAAA,mBAAgB,AAAD;IAE3C,IAAI;IACJ,IAAI;QACF,eAAe,MAAM,KAAK,aAAa,CAAC;IAC1C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;IAEA,MAAM,SAAS,aAAa,GAAG;IAE/B,IAAI;QACF,MAAM,aAAa,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC;QACrD,MAAM,UAAU,MAAM,WAAW,GAAG;QAEpC,IAAI,CAAC,QAAQ,MAAM,EAAE;YACnB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QACA,MAAM,cAAc,QAAQ,IAAI;QAChC,IAAI,CAAC,aAAa;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;QAC1C,MAAM,aAAa,QAAQ,GAAG,CAAC,mBAAmB;QAElD,IAAI,CAAC,UAAU,CAAC,YAAY;YACxB,QAAQ,KAAK,CAAC;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,MAAM,WAAW,IAAI,8IAAA,CAAA,UAAQ,CAAC;YAAE;YAAQ;QAAW;QAEnD,MAAM,mBAAmB;YACvB,SAAS;YACT,aAAa;YACb,UAAU;YACV,iBAAiB;YACjB,OAAO;gBACL,cAAc;YAChB;QACF;QAEA,MAAM,eAAe,MAAM,SAAS,aAAa,CAAC,MAAM,CAAC;QAEzD,wDAAwD;QACxD,IAAI,aAAa,WAAW,EAAE;YAC3B,MAAM,WAAW,GAAG,CAAC;gBAAE,oBAAoB,aAAa,WAAW;YAAC,GAAG;gBAAE,OAAO;YAAK;QACxF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,gBAAgB,aAAa,EAAE;YAAE,QAAQ;QAAO;IAE7E,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yCAAyC;QACvD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAsC,GAAG;YAAE,QAAQ;QAAI;IAC5G;AACF","debugId":null}}]
}