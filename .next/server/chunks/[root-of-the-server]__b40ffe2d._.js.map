{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase-admin.ts"],"sourcesContent":["\nimport * as admin from 'firebase-admin';\n\n// This utility ensures that the Firebase Admin SDK is initialized only once\n// across all server-side requests in a serverless environment.\n\ninterface FirebaseAdmin {\n  auth: admin.auth.Auth;\n  firestore: admin.firestore.Firestore;\n  storage: admin.storage.Storage;\n}\n\nif (!admin.apps.length) {\n  try {\n    admin.initializeApp({\n      credential: admin.credential.applicationDefault(),\n      storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n    });\n    console.log('Firebase Admin SDK initialized successfully.');\n  } catch (error) {\n    console.error('Firebase Admin SDK initialization error:', error);\n  }\n}\n\nconst auth = admin.auth();\nconst firestore = admin.firestore();\nconst storage = admin.storage();\n\nexport function getFirebaseAdmin(): FirebaseAdmin {\n  return { auth, firestore, storage };\n}\n"],"names":[],"mappings":";;;AACA;;AAWA,IAAI,CAAC,2HAAA,CAAA,OAAU,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,CAAA,GAAA,2HAAA,CAAA,gBAAmB,AAAD,EAAE;YAClB,YAAY,2HAAA,CAAA,aAAgB,CAAC,kBAAkB;YAC/C,eAAe,QAAQ,GAAG,CAAC,mCAAmC;QAChE;QACA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4CAA4C;IAC5D;AACF;AAEA,MAAM,OAAO,CAAA,GAAA,2HAAA,CAAA,OAAU,AAAD;AACtB,MAAM,YAAY,CAAA,GAAA,2HAAA,CAAA,YAAe,AAAD;AAChC,MAAM,UAAU,CAAA,GAAA,2HAAA,CAAA,UAAa,AAAD;AAErB,SAAS;IACd,OAAO;QAAE;QAAM;QAAW;IAAQ;AACpC","debugId":null}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/create-razorpay-customer/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getFirebaseAdmin } from '@/lib/firebase-admin';\nimport { doc, getDoc, updateDoc } from 'firebase-admin/firestore';\n\nconst RAZORPAY_KEY_ID = process.env.RAZORPAY_KEY_ID;\nconst RAZORPAY_KEY_SECRET = process.env.RAZORPAY_KEY_SECRET;\n\nexport async function POST(req: Request) {\n  try {\n    if (!RAZORPAY_KEY_ID || !RAZORPAY_KEY_SECRET) {\n      console.error('SERVER_ERROR: Razorpay API keys are not configured on the server.');\n      return NextResponse.json({ error: 'Server configuration error.' }, { status: 500 });\n    }\n    \n    const { idToken } = await req.json();\n    if (!idToken) {\n      return NextResponse.json({ error: 'Authentication token is missing.' }, { status: 401 });\n    }\n\n    const { auth, firestore } = getFirebaseAdmin();\n    const decodedToken = await auth.verifyIdToken(idToken);\n    const uid = decodedToken.uid;\n\n    const userDocRef = doc(firestore, 'users', uid);\n    const userDoc = await getDoc(userDocRef);\n\n    if (!userDoc.exists()) {\n      return NextResponse.json({ error: 'User not found in database.' }, { status: 404 });\n    }\n\n    const userData = userDoc.data();\n    if (userData.razorpayCustomerId) {\n      return NextResponse.json({ \n        customerId: userData.razorpayCustomerId,\n        message: 'Customer already exists.' \n      });\n    }\n\n    const customerData = {\n      name: `${userData.firstName || ''} ${userData.surname || ''}`.trim() || userData.email,\n      email: userData.email,\n      contact: userData.mobileNo || undefined,\n    };\n    \n    const authHeader = 'Basic ' + Buffer.from(`${RAZORPAY_KEY_ID}:${RAZORPAY_KEY_SECRET}`).toString('base64');\n\n    const response = await fetch('https://api.razorpay.com/v1/customers', {\n      method: 'POST',\n      headers: {\n        'Authorization': authHeader,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(customerData),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      console.error('RAZORPAY_API_ERROR:', errorData);\n      return NextResponse.json({ error: 'Failed to create Razorpay customer.', details: errorData }, { status: response.status });\n    }\n\n    const customer = await response.json();\n    \n    await updateDoc(userDocRef, {\n      razorpayCustomerId: customer.id,\n      updatedAt: new Date().toISOString(),\n    });\n\n    return NextResponse.json({ \n      customerId: customer.id,\n      message: 'Customer created successfully.' \n    });\n\n  } catch (error: any) {\n    console.error('INTERNAL_SERVER_ERROR in create-razorpay-customer:', error);\n    return NextResponse.json({ \n      error: 'An internal server error occurred.',\n      message: error.message \n    }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,kBAAkB,QAAQ,GAAG,CAAC,eAAe;AACnD,MAAM,sBAAsB,QAAQ,GAAG,CAAC,mBAAmB;AAEpD,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,IAAI,CAAC,mBAAmB,CAAC,qBAAqB;YAC5C,QAAQ,KAAK,CAAC;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;QAClC,IAAI,CAAC,SAAS;YACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QACxF;QAEA,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,iIAAA,CAAA,mBAAgB,AAAD;QAC3C,MAAM,eAAe,MAAM,KAAK,aAAa,CAAC;QAC9C,MAAM,MAAM,aAAa,GAAG;QAE5B,MAAM,aAAa,CAAA,GAAA,4JAAA,CAAA,MAAG,AAAD,EAAE,WAAW,SAAS;QAC3C,MAAM,UAAU,MAAM,CAAA,GAAA,4JAAA,CAAA,SAAM,AAAD,EAAE;QAE7B,IAAI,CAAC,QAAQ,MAAM,IAAI;YACrB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,WAAW,QAAQ,IAAI;QAC7B,IAAI,SAAS,kBAAkB,EAAE;YAC/B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,YAAY,SAAS,kBAAkB;gBACvC,SAAS;YACX;QACF;QAEA,MAAM,eAAe;YACnB,MAAM,GAAG,SAAS,SAAS,IAAI,GAAG,CAAC,EAAE,SAAS,OAAO,IAAI,IAAI,CAAC,IAAI,MAAM,SAAS,KAAK;YACtF,OAAO,SAAS,KAAK;YACrB,SAAS,SAAS,QAAQ,IAAI;QAChC;QAEA,MAAM,aAAa,WAAW,OAAO,IAAI,CAAC,GAAG,gBAAgB,CAAC,EAAE,qBAAqB,EAAE,QAAQ,CAAC;QAEhG,MAAM,WAAW,MAAM,MAAM,yCAAyC;YACpE,QAAQ;YACR,SAAS;gBACP,iBAAiB;gBACjB,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAuC,SAAS;YAAU,GAAG;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAC3H;QAEA,MAAM,WAAW,MAAM,SAAS,IAAI;QAEpC,MAAM,CAAA,GAAA,4JAAA,CAAA,YAAS,AAAD,EAAE,YAAY;YAC1B,oBAAoB,SAAS,EAAE;YAC/B,WAAW,IAAI,OAAO,WAAW;QACnC;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,YAAY,SAAS,EAAE;YACvB,SAAS;QACX;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sDAAsD;QACpE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,SAAS,MAAM,OAAO;QACxB,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF","debugId":null}}]
}